<!DOCTYPE html>
<html lang="tr">
<head>
    <base href="/">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Santis Club • Hizmet Detayı</title>
    
    <!-- FONTS & CSS -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600&family=Cormorant+Garamond:ital,wght@0,400;1,400&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="icon" href="favicon.ico">
</head>
<body class="editorial-mode">

    <!-- PRELOADER -->
    <div class="preloader" id="preloader" style="display:none;">
        <div class="preloader-logo">Santis Club</div>
    </div>

    <!-- NAVBAR -->
    <!-- NAVBAR -->
    <div id="navbar-container"></div>
    <!-- Script will load components/navbar.html here -->
    <div class="mobile-menu-overlay" id="mobileMenu" style="z-index: 999998;">
        <div class="mobile-menu-content">
            <a href="index.html" class="mobile-link">ANA SAYFA</a>
            <a href="tr/hamam/index.html" class="mobile-link">HAMAM RİTÜELLERİ</a>
            <a href="tr/masajlar/index.html" class="mobile-link">DÜNYA MASAJLARI</a>
            <a href="tr/cilt-bakimi/index.html" class="mobile-link">CİLT BAKIMI</a>
            <a href="tr/urunler/index.html" class="mobile-link">ÜRÜNLER</a>
            <a href="tr/galeri/index.html" class="mobile-link">GALERİ</a>
            <a href="booking.html" class="mobile-link">REZERVASYON</a>
        </div>
    </div>

    <main id="nv-main">
        <!-- HERO SECTION -->
        <section class="nv-hero-small">
            <img id="detail-hero-img" src="assets/img/hero-general.webp" alt="Hero" class="nv-hero-bg-img">
            <div class="nv-video-overlay"></div>
            <div class="nv-hero-content text-center">
                <span class="nv-kicker" id="detail-category">HİZMET DETAYI</span>
                <h1 class="nv-hero-title" id="detail-title">Yükleniyor...</h1>
            </div>
        </section>

        <!-- CONTENT SECTION -->
        <div class="nv-container nv-section">
            <div class="nv-detail-layout">
                <!-- Left: Text -->
                <div class="nv-content-col">
                    <h2 class="nv-editorial-title mb-30" id="detail-subtitle"></h2>
                    <p class="fs-18 lh-16 text-muted mb-40" id="detail-desc"></p>
                    
                    <div class="nv-meta-grid mb-40">
                        <div class="meta-item">
                            <span class="d-block text-gold fs-12 uppercase tracking-2">SÜRE</span>
                            <span class="d-block fs-18" id="detail-duration">-- dk</span>
                        </div>
                        <div class="meta-item">
                            <span class="d-block text-gold fs-12 uppercase tracking-2">FİYAT</span>
                            <span class="d-block fs-18" id="detail-price">-- €</span>
                        </div>
                    </div>

                    <div class="nv-actions">
                        <button onclick="window.location.href='booking.html'" class="nv-btn">REZERVASYON YAP</button>
                        <a href="index.html" class="nv-btn nv-btn-outline ml-20">ANA SAYFAYA DÖN</a>
                    </div>
                </div>

                <!-- Right: Image -->
                <div class="nv-visual-col curtain-reveal">
                    <img id="detail-card-img" src="" alt="" class="w-100 img-rounded shadow-2">
                </div>
            </div>
        </div>
    </main>

    <!-- FOOTER -->
    <div id="footer-container"></div>

    <!-- SCRIPTS -->
    <script src="assets/js/settings-data.js" defer></script>
    <script src="assets/js/fallback_data.js" defer></script>
    <script src="assets/js/core_data_loader.js" defer></script>
    <script src="assets/js/loader.js" defer></script>
    <script src="assets/js/url-normalizer.js" defer></script>
    <script src="assets/js/santis-nav.js" defer></script>
    <script src="assets/js/santis-booking.js" defer></script>
    <script src="assets/js/app.js" defer></script>
    <script src="assets/js/language-switcher.js?v=2.3" defer></script>

    <!-- INLINE LOGIC TO POPULATE DATA -->
    <script defer>
        document.addEventListener('DOMContentLoaded', () => {
            const params = new URLSearchParams(window.location.search);
            const slug = params.get('slug');

            if (typeof loadComp === "function") {
                loadComp("/components/navbar.html", "navbar-container");
                loadComp("/components/footer.html", "footer-container");
            }
            if (!slug) {
                // Redirect to homepage automatically in production
                // But for now, let's show a friendly message or redirect
                console.warn("⚠️ No slug provided. Redirecting to home...");
                window.location.replace("index.html");
                return;
            }

            // FIND SERVICE IN FALLBACK DATA
            // FIND SERVICE IN DATA (Unified)
            // Wait for data if utilizing core_data_loader
            const findService = () => {
                const data = window.CONTENT || window.SANTIS_FALLBACK || {};
                let service = null;
                
                // 1. Helper to search
                const search = (collection) => {
                    if(!collection) return null;
                    if(Array.isArray(collection)) return collection.find(s => s.id == slug || s.slug == slug);
                    return Object.values(collection).find(s => s.id == slug || s.slug == slug);
                };

                // 2. Try Global Arrays first (if hydrated)
                if(window.NV_HAMMAM) service = search(window.NV_HAMMAM);
                if(!service && window.NV_MASSAGES) service = search(window.NV_MASSAGES);
                if(!service && window.NV_SKINCARE) service = search(window.NV_SKINCARE);

                // 3. Try Raw Content
                if(!service && data.global) {
                    if(data.global.services) service = search(data.global.services);
                    if(!service && data.global.hammam) service = search(data.global.hammam);
                }

                return service;
            };

            const renderPage = () => {
                const service = findService();
                if (!service) {
                    console.warn("Service not found:", slug);
                     // Optional: Show 404 or redirect
                    return;
                }
                
                // Populate UI
                // ... (existing logic adaptation)
                document.title = (service.name?.tr || service.title || "Hizmet") + " • Santis Club";
                document.getElementById('detail-title').textContent = service.name?.tr || service.title;
                document.getElementById('detail-desc').innerHTML = service.desc?.tr || service.desc;
                document.getElementById('detail-price').textContent = service.price ? service.price + " €" : "Bilgi Al";
                document.getElementById('detail-duration').textContent = (service.duration || service.durationMin || "--") + " dk";
                
                if(service.img) {
                    const imgPath = service.img.startsWith('/') ? service.img.substring(1) : service.img;
                    const imgPathSafe = imgPath.startsWith('assets') ? imgPath : `assets/img/cards/${imgPath}`;
                    document.getElementById('detail-hero-img').src = imgPathSafe;
                }
                
                // WhatsApp Button
                const btn = document.getElementById('bookBtn');
                if(btn) {
                    const msg = encodeURIComponent(`${service.name?.tr || service.title} hakkında bilgi almak istiyorum.`);
                    btn.href = `https://wa.me/905348350169?text=${msg}`;
                }
            };

            // Init
            if(window.NV_DATA_READY_PROMISE) {
                window.NV_DATA_READY_PROMISE.then(renderPage);
            } else {
                setTimeout(renderPage, 500); // Fallback wait
            }
            }

            // Search in Arrays if not found (Massages, Skincare arrays shown in Step 594)
            // It seems "site_content.json" has mixed structure. Let's look everywhere.
            if (!service) {
                const arrays = [data.massages?.items, data.skincare?.items, data.hammam?.items];
                for (const arr of arrays) {
                    if (Array.isArray(arr)) {
                        const found = arr.find(s => s.slug === slug || s.id === slug);
                        if (found) { 
                            service = found; 
                            break; 
                        }
                    }
                }
            }
            
            // Hard Fallback for 'kese-kopuk' if missing in JSON
            if(!service && slug === 'kese-kopuk') {
                service = {
                    title: "Kese & Köpük Ritüeli",
                    desc: "Geleneksel Türk hamamının olmazsa olmazı. Ölü derilerden arınma ve köpükle gelen derin temizlik.",
                    duration: "45 dk",
                    price: 85,
                    img: "assets/img/cards/santis_card_hammam_v1.png"
                };
            }

            if (service) {
                // Populate UI
                const title = service.name ? (service.name.tr || service.name) : (service.title || "");
                const desc = service.desc ? (service.desc.tr || service.desc) : "";
                const price = service.price || "--";
                const dur = service.durationMin || service.duration || "--";
                const img = service.img || "assets/img/hero-general.webp";

                document.getElementById('detail-title').innerText = title;
                document.getElementById('detail-subtitle').innerText = title;
                document.getElementById('detail-desc').innerText = desc;
                document.getElementById('detail-price').innerText = price + " €";
                document.getElementById('detail-duration').innerText = typeof dur === 'number' ? dur + " dk" : dur;
                
                document.getElementById('detail-hero-img').src = img;
                document.getElementById('detail-card-img').src = img;
                
                document.title = "Santis Club • " + title;
            } else {
                document.getElementById('detail-title').innerText = "Hizmet Bulunamadı";
                document.getElementById('detail-desc').innerText = "Aradığınız hizmet (" + slug + ") veri tabanımızda bulunamadı.";
            }
        });
    </script>

</body>
</html>
